<!DOCTYPE html>
<html lang="en">
  <head>
<!--     <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Create and share R scripts :: ThoughtSpot Cloud</title>
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../../_/css/site.css">
 -->
<!-- begin couchbase banner logic -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>Create and share R scripts | ThoughtSpot Cloud</title>
    <link rel="stylesheet" href="../../../_/css/site.css">
<!-- end couchbase banner logic -->
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../.."><img src="../../../_/img/company_logo_white.svg" alt="ThoughtSpot logo" height="47.42" width="158"/><!--ThoughtSpot Cloud--></a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown">
          <!--<a class="navbar-link component" href="../index.html"><span class="title">ThoughtSpot Shared</span> <span class="version">6.1</span></a> -->
          <div class="navbar-dropdown navbar-item">
            <div class="cols">
              <ul>
              </ul>
            </div>
          </div>
        </div>
        <!-- <a class="navbar-item" href="#">Home</a> -->
<div class="navbar-item has-dropdown is-hoverable">
        <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://antora-software.netlify.app/">Software</a>
            <a class="navbar-item" href="#">Mobile</a>
          </div>
        </div>
      <!--  <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
        <a class="navbar-link" href="#">Resources</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Resource A</a>
            <a class="navbar-item" href="#">Resource B</a>
            <a class="navbar-item" href="#">Resource C</a>
          </div> -->
        </div>
<!-- <div class="navbar-item">
          <span class="control">
          <a class="button is-primary" href="https://antora-software.netlify.app/">Software</a>
</span>  -->
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="shared" data-version="6.1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-explore is-active" data-panel="explore">
  <div class="context">

  </div>
  <ul class="components">
    <li class="component">
      <span class="title">ThoughtSpot Cloud</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../cloud/6.1/index.html">6.1</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <span class="title">ThoughtSpot Shared</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">6.1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article"  data-ceiling="topbar">
  <!--   <div class="article-header"> -->
<!-- <button class="nav-control"></button>
 -->
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <!-- <a href="../../../cloud/6.1/index.html" class="home-link"></a> -->
<nav class="breadcrumbs" aria-label="breadcrumbs">
</nav>
</div>
  <div class="content">
<article class="doc">
<h1 class="page">Create and share R scripts</h1>
<div class="sect1">
<h2 id="_overview"><a class="anchor" href="#_overview"></a>Overview</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Custom R is disabled by default.
To turn on custom R scripting, contact your site administrator.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Each ThoughtSpot cluster is capable of running an R analysis on your data.
To perform your own R analysis, start with a simple search and click the R icon on the right.</p>
</div>
<div class="paragraph">
<p>Use the <strong>Custom R Script</strong> dialog and settings to enter your script, set which columns to include for analysis, and indicate what output data to expect from your script (PNG or CSV).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/r-script-dialog.png" alt="r script dialog">
</div>
</div>
<div class="paragraph">
<p>ThoughtSpot also supports the sharing of scripts among users to enable you to share your powerful R analyses across the system, and allow others to run your scripts on different search results.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_it_works"><a class="anchor" href="#_how_it_works"></a>How it works</h2>
<div class="sectionbody">
<div class="paragraph">
<p>An R script in ThoughtSpot is based off of your original search (both the data and the schema), using the columns you select for the analysis.
You can select all columns used in the original search or a subset of those columns, depending on the script.</p>
</div>
<div class="paragraph">
<p>ThoughtSpot auto generates objects with variable names by which you can refer to data elements in your script.</p>
</div>
<div class="paragraph">
<p>You can refer to the data in the selected columns by using vectors that ThoughtSpot generates for these before the script is run.
The first column you select has the variable name <code>.param0</code>, the second column you select has the variable name <code>.param1</code>, and so on.
This naming scheme continues if there are more columns.
(You can click the question mark icon <span class="image"><img src="/images/r-icon-question-mark.png" alt="question icon"></span> next to "<strong>Select columns for R analysis</strong>" to get a visual mapping of how the columns are bound to variables in R.)</p>
</div>
<div class="paragraph">
<p>ThoughtSpot also provides an automatically-generated <em>data frame</em> object, <code>df</code>, that contains all selected column vectors.
The data frame is R&#8217;s representation of a table (a 2D data structure containing rows and columns).</p>
</div>
<div class="paragraph">
<p>When the script executes, it passes the information to the server to run the analysis, and displays the answer as a visualization, in either PNG or CSV (table) format.</p>
</div>
<div class="paragraph">
<p>As we demonstrate in the following examples, you can chain R analyses together by running another R script on the answer to a previous script.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_write_a_custom_script"><a class="anchor" href="#_write_a_custom_script"></a>Write a custom script</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To add a custom R script, start by running a search, then click the <strong>R</strong> icon <span class="image"><img src="/images/r-icon-inline.png" alt="R icon"></span> on the toolbar.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/r-icon.png" alt="r icon">
</div>
</div>
<div class="paragraph">
<p>Add your script into the <strong>Custom R Script</strong> dialog, and set the <a href="#column-bindings">column bindings</a> and <a href="#output-file-type">output type</a> appropriately, as shown in the following examples.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/r-png-basic.png" alt="r png basic">
</div>
</div>
<div class="paragraph">
<p>For an R script to produce a meaningful output in ThoughtSpot, the script should generate a CSV or PNG file.
Output should be written to the token <code><mark>output_file</mark></code>.
CSV output is rendered back as a simple table in ThoughtSpot, PNG output is rendered back as a static PNG.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_basic_r_script_to_generate_csv_data"><a class="anchor" href="#_basic_r_script_to_generate_csv_data"></a>Basic R script to generate CSV data</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This is an example of a basic R script that generates CSV data.
(The <code>df</code> variable name must be lower case, as shown.)</p>
</div>
<div class="listingblock">
<div class="content">
<pre>write.csv(df,  #output_file#)</pre>
</div>
</div>
<div class="paragraph">
<p>The generated data is displayed back as a table when you run the analysis:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/r-csv-basic.png" alt="r csv basic">
</div>
</div>
<div class="paragraph">
<p>This basic script returns the same table results as if you did the query directly in ThoughtSpot and selected the table view, barring some additional formatting you get for free on the search.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/r-basic-table-search-result.png" alt="r basic table search result">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_basic_r_script_to_generate_a_png_graphic"><a class="anchor" href="#_basic_r_script_to_generate_a_png_graphic"></a>Basic R script to generate a PNG graphic</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This is an example of a basic R script that generates PNG data as output.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>png(#output_file#)
plot(.param0, .param1)</pre>
</div>
</div>
<div class="paragraph">
<p>The generated data is displayed back as a static PNG when you run the analysis:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/r-png-basic.png" alt="r png basic">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_column_bindings_and_output_file_type"><a class="anchor" href="#_column_bindings_and_output_file_type"></a>Column bindings and output file type</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Under <strong>Select column(s) for R analysis</strong>, you specify the data you want to send to R and how to send it.
If you do not make any choices here, all columns in the search are selected in the order they appear in the search bar.</p>
<div class="paragraph">
<p>In the examples above, <code>Year (Date)</code> is <code>.param0</code>, and <code>Sales</code> is <code>.param1</code>.
To verify this, click the question mark icon next to <strong>Select columns for R analysis</strong> to see the &#8220;column bindings&#8221;.
Reordering the columns changes the column bindings/params.</p>
</div>
</li>
<li>
<p>Under <strong>Output File Type</strong> Select PNG or CSV, depending on the output details and in your script.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_options_on_scripts"><a class="anchor" href="#_options_on_scripts"></a>Options on scripts</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can click these icons in the R script dialog to get more options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The R script information icon <span class="image"><img src="/images/r-icon-i.png" alt="more options menu icon"></span> provides a basic reference guide for creating an R analysis in ThoughtSpot.</p>
</li>
<li>
<p>The ellipses icon <span class="image"><img src="/images/icon-ellipses.png" alt="more options menu icon"></span> provides a menu with options to save or load a previously saved R script, as well as share your R script with other users in the system.</p>
</li>
<li>
<p>The arrow at the top right of the script dialog <span class="image"><img src="/images/r-icon-popout-arrow.png" alt="popout arrow"></span> opens a popout editor that gives you a larger space in which to view and edit your R script.</p>
</li>
<li>
<p>The question mark icon <span class="image"><img src="/images/r-icon-question-mark.png" alt="question icon"></span> next to "<strong>Select column(s) for R analysis</strong>" provides a visual mapping of how the columns are bound to variables in R.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_k_means_clustering_example_scripts"><a class="anchor" href="#_k_means_clustering_example_scripts"></a>K-Means clustering example scripts</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This script loads the <code>ggplot2</code> visualization package, labels the columns inside of the ThoughtSpot generated data frame object (<code>df</code>), and runs a K-Means clustering algorithm.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>library(ggplot2)

kmeansOutput &lt;- kmeans(df[1:2], 3, nstart = 20)
kmeansOutput$cluster &lt;- as.factor(kmeansOutput$cluster)
png(file=#output_file#, width=400, height=350, res=72)
print(ggplot(df, aes(.param0, .param1, color = kmeansOutput$cluster)) + geom_point())</pre>
</div>
</div>
<div class="paragraph">
<p>When you run this script on the results of the original <code>sales date</code> search, you get the following visualization as a PNG.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/r-custom-script-png.png" alt="r custom script png">
</div>
</div>
<div class="paragraph">
<p>You can run another R script directly on this result to get CSV results:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>kmeansOutput &lt;- kmeans(df[1:2], 3, nstart = 20);
df$Cluster &lt;- as.factor(kmeansOutput$cluster);
write.csv(df, file=#output_file#, row.names=FALSE);</pre>
</div>
</div>
<div class="paragraph">
<p>The script for CSV output generates a table:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/r-custom-script-csv.png" alt="r custom script csv">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_save_and_share_your_script"><a class="anchor" href="#_save_and_share_your_script"></a>Save and share your script</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To save a script, choose <strong>Save as</strong> from the options menu <span class="image"><img src="/images/icon-ellipses.png" alt="more options menu icon"></span> of the script.
After you name and save it, your script will show in the <strong>Load</strong> scripts dialog.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/r-save-script.png" alt="r save script">
</div>
</div>
<div class="paragraph">
<p>To share a script, choose <strong>Share</strong> from the options menu <span class="image"><img src="/images/icon-ellipses.png" alt="more options menu icon"></span>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/r-share-script.png" alt="r share script">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_more_script_examples"><a class="anchor" href="#_more_script_examples"></a>More script examples</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For some more example scripts, check out the blog post on <a href="https://www.thoughtspot.com/codex/using-r-analysis-thoughtspot-time-series-forecasting">Using R Analysis in ThoughtSpot for Time Series Forecasting</a>, or load one of the ThoughtSpot provided scripts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Binomial Logistic Regression</p>
</li>
<li>
<p>K-Means Clustering Plot</p>
</li>
<li>
<p>K-Means Clustering Table</p>
</li>
<li>
<p>Time Series Outlier Detection</p>
</li>
<li>
<p>Time Series Forecast</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/r-script-load-prebuilt.png" alt="r script load prebuilt">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_related_information"><a class="anchor" href="#_related_information"></a>Related information</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://www.thoughtspot.com/codex/using-r-analysis-thoughtspot-time-series-forecasting">Using R Analysis in ThoughtSpot for Time Series Forecasting</a> (blog post by Antony Chen of ThoughtSpot)</p>
</li>
<li>
<p><a href="https://www.r-project.org/">R Project for Statistical Computing</a></p>
</li>
</ul>
</div>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <ul>
          <li><a href="https://training.thoughtspot.com/" target="_blank" rel="noopener">Training</a></li>
          <li><a href="https://community.thoughtspot.com/" target="_blank" rel="noopener">Community</a></li>
          <li><a href="https://www.thoughtspot.com/" target="_blank" rel="noopener">ThoughtSpot.com</a></li>
	</ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <a href="https://www.facebook.com/ThoughtSpot/" class="icon">
              <svg width="50px" height="50px" viewBox="26.363 116.363 560.215 560.215"><path d="m586.58 209.58c0-48.96-44.252-93.212-93.212-93.212h-373.79c-48.96 0-93.212 44.252-93.212 93.212v373.79c0 48.96 44.252 93.212 93.212 93.212h186.42v-211.85h-68.732v-93.212h68.732v-36.72c0-63.083 47.077-119.58 105.45-119.58h75.323v93.212h-75.323c-8.474 0-17.889 10.357-17.889 25.422v37.662h93.212v93.212h-93.212v211.85h99.803c48.96 0 93.212-44.252 93.212-93.212v-373.79z"/></svg>
            </a>
          </li>
          <li>
            <a href="https://twitter.com/ThoughtSpot/" class="icon">
              <svg width="50px" height="50px" viewBox="32.012 176.622 542.326 437.815"><path d="m574.34 227.46c-19.772 8.474-41.428 15.065-64.025 17.889 22.597-14.123 40.486-35.778 48.96-61.2-21.655 13.182-45.194 21.655-70.615 27.305-20.714-21.655-48.96-34.837-80.972-34.837-61.2 0-111.1 49.902-111.1 111.1 0 8.474 0.942 16.948 2.825 25.422-92.271-5.649-174.18-49.902-229.74-117.69-9.415 16.006-15.065 35.778-15.065 55.551 0 38.603 19.772 72.498 49.902 92.271-17.889-0.942-35.778-5.649-50.843-14.123v0.942c0 53.668 38.603 98.862 89.446 109.22-9.415 2.825-18.831 3.766-29.188 3.766-7.532 0-14.123-0.942-20.714-1.883 14.123 44.252 55.551 76.265 103.57 77.206-37.662 30.129-85.68 48.018-138.41 48.018-9.415 0-17.889-0.941-26.363-1.883 48.96 32.012 107.34 49.902 170.42 49.902 204.31 0 316.36-169.48 316.36-316.36v-14.123c21.656-14.125 40.487-33.897 55.551-56.494z"/></svg>
            </a>
          </li>
          <li>
            <a href="https://www.linkedin.com/company/thoughtspot/" class="icon">
              <svg width="50px" height="50px" viewBox="31.071 119.188 539.537 540.443"><path d="m531.97 119.19h-461.35c-21.655 0-39.545 16.948-39.545 38.603v463.24c0 21.655 17.889 38.603 39.545 38.603h460.41c21.655 0 39.545-16.948 39.545-38.603v-463.24c0.942-21.656-16.947-38.603-38.603-38.603zm-337.07 451.94h-81.914v-243.86h81.914v243.86zm-40.486-276.81c-28.246 0-46.135-18.831-46.135-42.369s17.889-42.369 46.135-42.369 45.194 17.889 45.194 42.369c0.942 23.538-16.948 42.369-45.194 42.369zm335.19 276.81h-81.914v-129.93c0-32.954-12.24-55.551-41.428-55.551-22.597 0-35.778 15.065-41.428 30.129-1.883 5.649-2.825 12.24-2.825 19.772v136.52h-81.914s0.942-221.26 0-243.86h81.914v34.837c11.298-16.948 30.129-40.486 73.44-40.486 53.668 0 94.154 34.837 94.154 110.16l1e-3 138.41zm-168.54-208.08s0.941-0.941 0 0z"/></svg>
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <span>&copy;2020 ThoughtSpot, Inc. All rights reserved.</span>
      <a href="https://www.thoughtspot.com/privacy-policy">Privacy Statement</a>
      <a href="https://www.thoughtspot.com/support">Support</a>
      <a href="https://www.thoughtspot.com/thoughtspot-website-terms-use">Terms of Use</a>
    </div>
  </div>
</footer>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
