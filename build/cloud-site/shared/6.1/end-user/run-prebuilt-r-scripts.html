<!DOCTYPE html>
<html lang="en">
  <head>
<!--     <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    
    <title>Run prebuilt R scripts on answers :: ThoughtSpot Cloud</title>
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <link rel="icon" href="../../../favicon.ico" type="image/x-icon">
 -->
<!-- begin couchbase banner logic -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Run prebuilt R scripts on answers | ThoughtSpot Cloud</title>
    <link rel="stylesheet" href="../../../_/css/site.css">
    <link rel="icon" href="../../../favicon.ico" type="image/x-icon">
<!-- end couchbase banner logic -->
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../.."><img src="../../../_/img/company_logo_white.svg" alt="ThoughtSpot logo" height="47.42" width="158"/><!--ThoughtSpot Cloud--></a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown">
          <!--<a class="navbar-link component" href="../index.html"><span class="title">ThoughtSpot Shared</span> <span class="version">6.1</span></a> -->
          <div class="navbar-dropdown navbar-item">
            <div class="cols">
              <ul>
              </ul>
            </div>
          </div>
        </div>
        <!-- <a class="navbar-item" href="#">Home</a> -->
<div class="navbar-item has-dropdown is-hoverable">
        <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://antora-software.netlify.app/">Software</a>
            <a class="navbar-item" href="#">Mobile</a>
          </div>
        </div>
      <!--  <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
        <a class="navbar-link" href="#">Resources</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Resource A</a>
            <a class="navbar-item" href="#">Resource B</a>
            <a class="navbar-item" href="#">Resource C</a>
          </div> -->
        </div>
<!-- <div class="navbar-item">
          <span class="control">
          <a class="button is-primary" href="https://antora-software.netlify.app/">Software</a>
</span>  -->
        </div>
      </div>
    </div>
  </nav>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@algolia/algoliasearch-netlify-frontend@0/dist/algoliasearchNetlify.css" />
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@algolia/algoliasearch-netlify-frontend@0/dist/algoliasearchNetlify.js"></script>
  <script type="text/javascript">
    algoliasearchNetlify({
      appId: '56SYO9D81N',
      apiKey: '0e8e3283d497629efe978f104a265e6f',
      siteId: 'da2c98c2-73c9-41a9-a094-3310c050f655',
      branch: '6.1',
    });
  </script>
</header>
<div class="body">
<div class="nav-container" data-component="shared" data-version="6.1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-explore is-active" data-panel="explore">
  <div class="context">

  </div>
  <ul class="components">
    <li class="component">
      <span class="title">ThoughtSpot Cloud</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../cloud/6.1/index.html">6.1</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <span class="title">ThoughtSpot Shared</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">6.1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article"  data-ceiling="topbar">
  <!--   <div class="article-header"> -->
<!-- <button class="nav-control"></button>
 -->
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<!--  <a href="../../../cloud/6.1/index.html" class="home-link"></a> -->
<nav class="breadcrumbs" aria-label="breadcrumbs">
</nav>
</div>
  <div class="content">
<article class="doc">
<h1 class="page">Run prebuilt R scripts on answers</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>If you have R privileges on your ThoughtSpot instance, you can run R analyses on search results, and save and share the resulting visualization with others.
The users you share visualizations with do not need R privileges.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_run_an_r_analysis"><a class="anchor" href="#_run_an_r_analysis"></a>Run an R analysis</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click the <strong>R</strong> icon <span class="image"><img src="/images/r-icon-inline.png" alt="R icon"></span> on the toolbar for any search result (answer).</p>
<div class="imageblock">
<div class="content">
<img src="/images/r-icon-marketspot.png" alt="r icon marketspot">
</div>
</div>
<div class="paragraph">
<p>From here, you have options to write a custom script, or load a pre-built or ThoughtSpot provided script.</p>
</div>
</li>
<li>
<p>In the Analyze dialog, click the ellipses icon <span class="image"><img src="/images/icon-ellipses.png" alt="more options menu icon"></span> next to the <strong>Custom R Script</strong> panel, and choose <strong>Load</strong>.</p>
<div class="imageblock">
<div class="content">
<img src="/images/r-load-prebuilt.png" alt="r load prebuilt">
</div>
</div>
<div class="paragraph">
<p>This brings up a list of pre-built scripts, both provided by ThoughtSpot and any created by programmers on your team.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/r-load-list-of-scripts.png" alt="r load list of scripts">
</div>
</div>
</li>
<li>
<p>Select a script, then choose the columns you want to include in the analysis and the output file type (PNG or CSV).</p>
<div class="paragraph">
<p>Note that the output file type must match the script.</p>
</div>
<div class="paragraph">
<p>For example, if you select one of the ThoughtSpot provided time series  scripts, the comment at the top of the script provides guidance on what  columns to select.</p>
</div>
<div class="listingblock">
<div class="content">
<pre> # NOTE: Only two columns are needed for this analysis.
 # The first column should represent some date column
 # and the second should be some numeric measure column.</pre>
</div>
</div>
<div class="paragraph">
<p>Also, scroll through the script to identify whether it&#8217;s coded to produce  graphical (PNG) or tabular (CSV) output.
The time series scripts are both set up  to produce graphical output, as indicated by a line like this at the end of the  scripts.</p>
</div>
<div class="listingblock">
<div class="content">
<pre> png(#output_file#, width=1000);
 print(img);</pre>
</div>
</div>
</li>
<li>
<p>Select <strong>Run Analysis</strong> to execute the script.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_time_series_outlier_example"><a class="anchor" href="#_time_series_outlier_example"></a>Time Series Outlier Example</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this example, we ran an analysis for <strong>Time Series Outlier Detection</strong> on search results that show sales totals by date.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/r-run-time-series-outliers-script.png" alt="r run time series outliers script">
</div>
</div>
<div class="paragraph">
<p>Note that we included a date column and a measure, and selected PNG as the output to match what the script requires.
The original search could have had more columns than this, but you can always structure the analysis properly by selecting only the date column and measure column you want to focus on.</p>
</div>
<div class="paragraph">
<p>In this case, no outliers were found, so the R visualization matches the original search result line graph.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_time_series_forecast_example"><a class="anchor" href="#_time_series_forecast_example"></a>Time Series Forecast Example</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this example, we ran a <strong>Time Series Forecast</strong> on the same search result.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/r-run-time-forecast-script.png" alt="r run time forecast script">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_diverging_bars_example"><a class="anchor" href="#_diverging_bars_example"></a>Diverging Bars Example</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Here is an example of taking a script found online and repurposing it for a use case in ThoughtSpot.
Antony Chen demo&#8217;ed this in a SpotOn webinar.
You can find his full presentation on Custom R Scripts and demo at <a href="https://community.thoughtspot.com/t/m2dftj">SpotOn Learning: ThoughtSpot 5.0 BI and Data Science Features</a> in the Community.</p>
</div>
<div class="paragraph">
<p>Consider this script, found on this website of <a href="http://r-statistics.co/Top50-Ggplot2-Visualizations-MasterList-R-Code.html">Top 50 ggplot2 Visualizations - The Master List (With Full R Code)</a>.
A direct link to this script is <a href="http://r-statistics.co/Top50-Ggplot2-Visualizations-MasterList-R-Code.html#Diverging%20Bars">here</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>library(ggplot2)
theme_set(theme_bw())

# Data Prep
data("mtcars")  # load data
mtcars$`car name` &lt;- rownames(mtcars)  # create new column for car names
mtcars$mpg_z &lt;- round((mtcars$mpg - mean(mtcars$mpg))/sd(mtcars$mpg), 2)  # compute normalized mpg
mtcars$mpg_type &lt;- ifelse(mtcars$mpg_z &lt; 0, "below", "above")  # above / below avg flag
mtcars &lt;- mtcars[order(mtcars$mpg_z), ]  # sort
mtcars$`car name` &lt;- factor(mtcars$`car name`, levels = mtcars$`car name`)  # convert to factor to retain sorted order in plot.

# Diverging Barcharts
ggplot(mtcars, aes(x=`car name`, y=mpg_z, label=mpg_z)) +
  geom_bar(stat='identity', aes(fill=mpg_type), width=.5)  +
  scale_fill_manual(name="Mileage",
                    labels = c("Above Average", "Below Average"),
                    values = c("above"="#00ba38", "below"="#f8766d")) +
  labs(subtitle="Normalised mileage from 'mtcars'",
       title= "Diverging Bars") +
  coord_flip()</pre>
</div>
</div>
<div class="paragraph">
<p>You can modify the script above to support the phone sales use case discussed in the webinar.</p>
</div>
<div class="paragraph">
<p>In this script, <code>mtcars</code> is replaced with references to our phone sales (<code>df$Sales</code>) and <code>car name</code> is replaced with <code>Device Name</code> both from the column data in the search example used in the webinar demo.
The script uses the ThoughtSpot <em>data frame</em> object (<code>df</code>), and adds two lines at the end to specify output type as a <code>png</code> image.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>library(ggplot2)
theme_set(theme_bw())

# Data Prep
df$sales_z &lt;- round((df$Sales - mean(df$Sales))/sd(df$Sales), 2)  # compute normalized mpg
df$sales_type &lt;- ifelse(df$sales_z &lt; 0, "below", "above")  # above / below avg flag
df &lt;- df[order(df$sales_z), ]  # sort
df$`Device Name` &lt;- factor(df$`Device Name`, levels = df$`Device Name`)  # convert to factor to retain sorted order in plot.

# Diverging Barcharts
img &lt;- ggplot(df, aes(x=`Device Name`, y=sales_z, label=sales_z)) +
  geom_bar(stat='identity', aes(fill=sales_type), width=.5)  +
  scale_fill_manual(name="Sales",
                    labels = c("Above Average", "Below Average"),
                    values = c("above"="#00ba38", "below"="#f8766d")) +
  labs(subtitle="Normalised Sales for Phones",
       title= "Diverging Bars") +
  coord_flip()
png(#output_file#, width=1000, height=1000)
print(img)</pre>
</div>
</div>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <ul>
          <li><a href="https://training.thoughtspot.com/" target="_blank" rel="noopener">Training</a></li>
          <li><a href="https://community.thoughtspot.com/" target="_blank" rel="noopener">Community</a></li>
          <li><a href="https://www.thoughtspot.com/" target="_blank" rel="noopener">ThoughtSpot.com</a></li>
	</ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <a href="https://www.facebook.com/ThoughtSpot/" class="icon">
              <svg width="50px" height="50px" viewBox="26.363 116.363 560.215 560.215"><path d="m586.58 209.58c0-48.96-44.252-93.212-93.212-93.212h-373.79c-48.96 0-93.212 44.252-93.212 93.212v373.79c0 48.96 44.252 93.212 93.212 93.212h186.42v-211.85h-68.732v-93.212h68.732v-36.72c0-63.083 47.077-119.58 105.45-119.58h75.323v93.212h-75.323c-8.474 0-17.889 10.357-17.889 25.422v37.662h93.212v93.212h-93.212v211.85h99.803c48.96 0 93.212-44.252 93.212-93.212v-373.79z"/></svg>
            </a>
          </li>
          <li>
            <a href="https://twitter.com/ThoughtSpot/" class="icon">
              <svg width="50px" height="50px" viewBox="32.012 176.622 542.326 437.815"><path d="m574.34 227.46c-19.772 8.474-41.428 15.065-64.025 17.889 22.597-14.123 40.486-35.778 48.96-61.2-21.655 13.182-45.194 21.655-70.615 27.305-20.714-21.655-48.96-34.837-80.972-34.837-61.2 0-111.1 49.902-111.1 111.1 0 8.474 0.942 16.948 2.825 25.422-92.271-5.649-174.18-49.902-229.74-117.69-9.415 16.006-15.065 35.778-15.065 55.551 0 38.603 19.772 72.498 49.902 92.271-17.889-0.942-35.778-5.649-50.843-14.123v0.942c0 53.668 38.603 98.862 89.446 109.22-9.415 2.825-18.831 3.766-29.188 3.766-7.532 0-14.123-0.942-20.714-1.883 14.123 44.252 55.551 76.265 103.57 77.206-37.662 30.129-85.68 48.018-138.41 48.018-9.415 0-17.889-0.941-26.363-1.883 48.96 32.012 107.34 49.902 170.42 49.902 204.31 0 316.36-169.48 316.36-316.36v-14.123c21.656-14.125 40.487-33.897 55.551-56.494z"/></svg>
            </a>
          </li>
          <li>
            <a href="https://www.linkedin.com/company/thoughtspot/" class="icon">
              <svg width="50px" height="50px" viewBox="31.071 119.188 539.537 540.443"><path d="m531.97 119.19h-461.35c-21.655 0-39.545 16.948-39.545 38.603v463.24c0 21.655 17.889 38.603 39.545 38.603h460.41c21.655 0 39.545-16.948 39.545-38.603v-463.24c0.942-21.656-16.947-38.603-38.603-38.603zm-337.07 451.94h-81.914v-243.86h81.914v243.86zm-40.486-276.81c-28.246 0-46.135-18.831-46.135-42.369s17.889-42.369 46.135-42.369 45.194 17.889 45.194 42.369c0.942 23.538-16.948 42.369-45.194 42.369zm335.19 276.81h-81.914v-129.93c0-32.954-12.24-55.551-41.428-55.551-22.597 0-35.778 15.065-41.428 30.129-1.883 5.649-2.825 12.24-2.825 19.772v136.52h-81.914s0.942-221.26 0-243.86h81.914v34.837c11.298-16.948 30.129-40.486 73.44-40.486 53.668 0 94.154 34.837 94.154 110.16l1e-3 138.41zm-168.54-208.08s0.941-0.941 0 0z"/></svg>
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <span>&copy;2020 ThoughtSpot, Inc. All rights reserved.</span>
      <a href="https://www.thoughtspot.com/privacy-policy">Privacy Statement</a>
      <a href="https://www.thoughtspot.com/support">Support</a>
      <a href="https://www.thoughtspot.com/thoughtspot-website-terms-use">Terms of Use</a>
    </div>
  </div>
</footer>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
<script async src="../../../_/js/vendor/bootstrap.js"></script>
<script async src="../../../_/js/vendor/jquery.js"></script>
  </body>
</html>
